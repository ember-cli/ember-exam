/**
 *
 * Get the weight for a given module name, a file path to the module defaultly generated by emberjs.
 * Ember tests are consist of Acceptance, Integration, Unit, and lint tests. In general, acceptance takes
 * longest time to execute and integration, init, and others. If the test type is not identifiable from the modulePath,
 * it will default to weight = 50 (ordered after acceptance, but before integration)
 * Ember 3.3 introduces the new types of tests (Container and Rendering tests) and they will still be generated within
 * the integration & unit directory.
 *
 * @param {String} modulePath A file path to a module
 */
function getWeight(modulePath) {
    const [_,key] = /\/(jshint|unit|integration|acceptance)\//.exec(modulePath) || [];
    return WEIGHT_MAP[key] || WEIGHT_DEFAULT;
}

const WEIGHT_MAP = {jshint:1, unit:10, integration:20, acceptance:150};
const WEIGHT_DEFAULT = 50;

export default function weightTestModules(modules) {
    const groups = {};

    modules.forEach(function(module) {
        const moduleWeight = getWeight(module);

        if (!groups[moduleWeight]) {
            groups[moduleWeight] = [];
        }
        groups[moduleWeight].push(module);
    });

    // returns a sorted list of the weights in descending order
    return Object.keys(groups)
                .sort(function(a, b){return b-a})
                .reduce( function(accumulatedArray, weight) {
                    const sortedModuleArr = groups[weight].sort();
                    return accumulatedArray.concat(sortedModuleArr);
                }, []);
}